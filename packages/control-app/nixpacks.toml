# Railway Nixpacks configuration for Control App
[phases.setup]
nixPkgs = ["nodejs_20", "pnpm"]

[phases.install]
cmds = [
  "echo 'ðŸ“¦ Installing dependencies...'",
  "cd /app",
  "pnpm install --frozen-lockfile --prefer-offline"
]

[phases.build]
cmds = [
  "echo 'ðŸ”¨ Building shared package...'",
  "cd /app/packages/shared && pnpm build",
  "echo 'ðŸ”¨ Building Control App...'",
  "cd /app/packages/control-app && pnpm build",
  "echo 'âœ… Build complete!'",
  "ls -la /app/packages/control-app/dist"
]

[start]
# Serve static files using a simple HTTP server
cmd = "npx serve -s packages/control-app/dist -l ${PORT:-3000}"

[variables]
NODE_ENV = "production"
